# Тестовое задание для отбора на Летнюю ИТ-школу КРОК по разработке

## Условие задания
Один развивающийся и перспективный маркетплейс активно растет в настоящее время. Текущая команда разработки вовсю занята тем, что развивает ядро системы. Помимо этого, перед CTO маркетплейса стоит задача — разработать подсистему аналитики, которая на основе накопленных данных формировала бы разнообразные отчеты и статистику.

Вы — компания подрядчик, с которой маркетплейс заключил рамочный договор на выполнение работ по разработке этой подсистемы. В рамках первого этапа вы условились провести работы по прототипированию и определению целевого технологического стека и общих подходов к разработке.

На одном из совещаний с Заказчиком вы определили задачу, на которой будете выполнять работы по прототипированию. В качестве такой задачи была выбрана разработка отчета о периодах наибольших трат со стороны пользователей.

Аналитики со стороны маркетплейса предоставили небольшой срез массива данных (файл format.json) о покупках пользователей, на примере которого вы смогли бы ознакомиться с форматом входных данных. Каждая запись данного среза содержит следующую информацию:
- Идентификатор пользователя;
- Дата и время оформления заказа;
- Статус заказа;
- Сумма заказа.

В пояснительной записке к массиву данных была уточняющая информация относительно статусов заказов:
- COMPLETED (Завершенный заказ);
- CANCELED (Отмененный заказ);
- CREATED (Созданный заказ, еще не оплаченный);
- DELIVERY (Созданный и оплаченный заказ, который доставляется).

Необходимо разработать отчет, вычисляющий по полученному массиву данных месяц, когда пользователи тратили больше всего. Если максимальная сумма пользовательских трат была в более, чем одном месяце, отчет должен показывать все такие месяцы. В отчете должны учитываться только завершенные заказы.

Требования к реализации:
1. Реализация должна содержать, как минимум, одну процедуру (функцию/метод), отвечающую за формирование отчета, и должна быть описана в readme.md в соответствии с чек-листом;
2. В качестве входных данных программа использует json-файл (input.json), соответствующий структуре, описанной в условиях задания;
3. Процедура (функция/метод) формирования отчета должна возвращать строку в формате json следующего формата:
   - {«months»: [«march»]} 
   - {«months»: [«march», «december»]}
4. Найденный в соответствии с условием задачи месяц должен выводиться на английском языке в нижнем регистре. Если месяцев несколько, то на вывод они все подаются на английском языке в нижнем регистре в порядке их следования в течение года.

## Автор решения
Коршкова Анастасия
## Описание реализации
Импорт  модулей:
- json используется для загрузки данных из файла формата JSON.
- defaultdict  создание словарей, которые автоматически создают значения, если ключ отсутствует.
- datetime обработка времени и даты
Открытие файла и загрузка данных:
- Файл открывается в режиме чтения с помощью with open(file, 'r') as f
- Данные загружаются из файла в формате JSON с помощью json.load(f)
- user_monthly_spending = defaultdict(lambda: defaultdict(float)) создается вложенный словарь,при помощи анонимной функции lambda, где первый уровень ключей — идентификаторы пользователей, а второй уровень — названия месяцев в нижнем регистре. Значения по умолчанию для внутренних словарей установлены как float , чтобы можно было сразу суммировать расходы
- for entry in data:— цикл  транзакции 
- ordered = datetime.fromisoformat(entry['ordered_at'])  превращает строку даты в объект datetime.
- month = ordered.strftime('%B').lower() преобразует дату в строку с названием месяца в нижнем регистре
- if entry['status'] in ['COMPLETED']  проверка статуса транзакции, чтобы убедиться, что она завершена
- user_monthly_spending[entry['user_id']][month] += float(entry['total']) добавляет сумму  к  пользователю и месяцу
- Создаются две переменные: max_spending_months = set() и max_spending = 0 для вычисления максимальной суммы покупки по месяцу
- for user, monthly_spending in user_monthly_spending.items проход по всем пользователям и их покупкам
- for month, spending in monthly_spending.items() проход по всем месяцам и расходам  
- if spending > max_spending: если расходы в текущем месяце больше, чем текущий максимум, этот месяц становится новым по расходам
- elif spending == max_spending:  если расходы равны текущему максимуму, добавляется еще один месяц в max_spending_months
- max_spending_months = {month} и max_spending = spending если текущие расходы больше максимальных, пересоздается набор max_spending_months, и устанавливается новое значение max_spending.
- return {'months': list(max_spending_months)  возвращение результата в виде списка месяцев, в которых зафиксирован максимальный расход
## Инструкция по сборке и запуску решения
- Создайте папку проекта с помощью команды:
mkdir <name>
- Перейдите в каталог проекта с помощью команды:
cd <name>
- Склонируйте репозиторий на свой локальный компьютер с помощью команды:
git clone <URL_репозитория>
- Убедитесь, что у вас установлен Python и библиотеки json и datetime. Если нет, установите их с помощью команды:
pip3 install json datetime -y
- Запустите скрипт с помощью команды:
python3 spending_analysis.py
- Результат будет выведен в консоль.
